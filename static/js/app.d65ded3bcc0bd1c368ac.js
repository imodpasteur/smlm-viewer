webpackJsonp([1],{"4+hh":function(e,t){},"A+BG":function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("7+uW"),n=i("/ocq"),s=i("//Fk"),r=i.n(s),o=i("Xxa5"),l=i.n(o),d=i("exGp"),m=i.n(d),c=i("woOf"),f=i.n(c),_=i("bOdI"),h=i.n(_);var u,p={getPixels:function(e){var t=e;return t.getContext("2d").getImageData(0,0,t.width,t.height)},filterImage:function(e,t,i){for(var a=[e],n=2;n<arguments.length;n++)a.push(arguments[n]);return t.apply(null,a)},grayscale:function(e,t){for(var i=e.data,a=0;a<i.length;a+=4){var n=.2126*i[a]+.7152*i[a+1]+.0722*i[a+2];i[a]=i[a+1]=i[a+2]=n}return e},brightness:function(e,t,i){for(var a,n=e.data,s=0;s<n.length;s+=4)(a=parseInt((n[s]-t)*i))>255?a=255:a<0&&(a=0),n[s]=a,n[s+1]=a,n[s+2]=a,n[s+3]=255;return e},min_max:function(e){for(var t=e.data,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=0,s=0;s<t.length;s+=4)t[s]<i&&(i=t[s]),t[s]>a&&(a=t[s]),n+=t[s]/(t.length/4);return{min:i,max:a,avg:n}},lut:function(e,t){for(var i,a=e.data,n=0;n<a.length;n+=4)i=a[n],a[n]=t[i][0],a[n+1]=t[i][1],a[n+2]=t[i][2],a[n+3]=255;return e}},g=[[10,0,0],[13,0,0],[15,0,0],[18,0,0],[21,0,0],[23,0,0],[26,0,0],[28,0,0],[31,0,0],[34,0,0],[36,0,0],[39,0,0],[42,0,0],[44,0,0],[47,0,0],[49,0,0],[52,0,0],[55,0,0],[57,0,0],[60,0,0],[63,0,0],[65,0,0],[68,0,0],[70,0,0],[73,0,0],[76,0,0],[78,0,0],[81,0,0],[84,0,0],[86,0,0],[89,0,0],[91,0,0],[94,0,0],[97,0,0],[99,0,0],[102,0,0],[105,0,0],[107,0,0],[110,0,0],[112,0,0],[115,0,0],[118,0,0],[120,0,0],[123,0,0],[126,0,0],[128,0,0],[131,0,0],[133,0,0],[136,0,0],[139,0,0],[141,0,0],[144,0,0],[147,0,0],[149,0,0],[152,0,0],[154,0,0],[157,0,0],[160,0,0],[162,0,0],[165,0,0],[168,0,0],[170,0,0],[173,0,0],[175,0,0],[178,0,0],[181,0,0],[183,0,0],[186,0,0],[189,0,0],[191,0,0],[194,0,0],[196,0,0],[199,0,0],[202,0,0],[204,0,0],[207,0,0],[210,0,0],[212,0,0],[215,0,0],[217,0,0],[220,0,0],[223,0,0],[225,0,0],[228,0,0],[231,0,0],[233,0,0],[236,0,0],[238,0,0],[241,0,0],[244,0,0],[246,0,0],[249,0,0],[252,0,0],[254,0,0],[255,2,0],[255,5,0],[255,7,0],[255,10,0],[255,12,0],[255,15,0],[255,18,0],[255,20,0],[255,23,0],[255,26,0],[255,28,0],[255,31,0],[255,33,0],[255,36,0],[255,39,0],[255,41,0],[255,44,0],[255,47,0],[255,49,0],[255,52,0],[255,54,0],[255,57,0],[255,60,0],[255,62,0],[255,65,0],[255,68,0],[255,70,0],[255,73,0],[255,75,0],[255,78,0],[255,81,0],[255,83,0],[255,86,0],[255,89,0],[255,91,0],[255,94,0],[255,96,0],[255,99,0],[255,102,0],[255,104,0],[255,107,0],[255,110,0],[255,112,0],[255,115,0],[255,117,0],[255,120,0],[255,123,0],[255,125,0],[255,128,0],[255,131,0],[255,133,0],[255,136,0],[255,138,0],[255,141,0],[255,144,0],[255,146,0],[255,149,0],[255,151,0],[255,154,0],[255,157,0],[255,159,0],[255,162,0],[255,165,0],[255,167,0],[255,170,0],[255,172,0],[255,175,0],[255,178,0],[255,180,0],[255,183,0],[255,186,0],[255,188,0],[255,191,0],[255,193,0],[255,196,0],[255,199,0],[255,201,0],[255,204,0],[255,207,0],[255,209,0],[255,212,0],[255,214,0],[255,217,0],[255,220,0],[255,222,0],[255,225,0],[255,228,0],[255,230,0],[255,233,0],[255,235,0],[255,238,0],[255,241,0],[255,243,0],[255,246,0],[255,249,0],[255,251,0],[255,254,0],[255,255,2],[255,255,6],[255,255,10],[255,255,14],[255,255,18],[255,255,22],[255,255,26],[255,255,30],[255,255,34],[255,255,38],[255,255,42],[255,255,46],[255,255,50],[255,255,54],[255,255,58],[255,255,62],[255,255,65],[255,255,69],[255,255,73],[255,255,77],[255,255,81],[255,255,85],[255,255,89],[255,255,93],[255,255,97],[255,255,101],[255,255,105],[255,255,109],[255,255,113],[255,255,117],[255,255,121],[255,255,125],[255,255,128],[255,255,132],[255,255,136],[255,255,140],[255,255,144],[255,255,148],[255,255,152],[255,255,156],[255,255,160],[255,255,164],[255,255,168],[255,255,172],[255,255,176],[255,255,180],[255,255,184],[255,255,188],[255,255,191],[255,255,195],[255,255,199],[255,255,203],[255,255,207],[255,255,211],[255,255,215],[255,255,219],[255,255,223],[255,255,227],[255,255,231],[255,255,235],[255,255,239],[255,255,243],[255,255,247],[255,255,251],[255,255,255]],v=i("mtWM"),w=i.n(v),x=i("lDdF"),b=i("mvHQ"),y=i.n(b),k=i("Zrlr"),S=i.n(k),F=i("wxAW"),C=i.n(F);var A,T,E,z,M,D=function(){function e(t){S()(this,e),this.manifest=JSON.parse(y()(U)),this.formats=this.manifest.formats,this.files=this.manifest.files,this.channels={},this.zipFile=null,this.uploaded=!1,this.isSMLM=!1,this.manifest.license=this.manifest.license||"CC BY 4.0",this.manifest.tags=this.manifest.tags||[],this.manifest.citeAs=this.manifest.citeAs||""}return C()(e,[{key:"import_image",value:function(e,t,i,a,n){var s=this;return new r.a(function(n,r){console.log("import file",t);var o=new FileReader;o.onload=function(r){var o=new Image;o.addEventListener("load",function(){var r={};r.format=t,r.type="image",r.size=[o.height,o.width],f()(r,i);var l={};l.image=o,l.file=e,l.name=e.name,l.file_name=e.name,l.file_size=e.size,r.name=e.name,r.data=l;var d=s.calculate_hash(r);r.hash=d,r.tags=i.tags||[],r.pixel_size=i.pixel_size,l.file_hash=d,a||!s.files||0==s.files.length?s.files.push(r):(s.manifest=JSON.parse(y()(U)),s.formats=s.manifest.formats,s.files=s.manifest.files,s.files.push(r)),s.formats[t]=R[t],s.manifest.name&&""!=s.manifest.name||(s.isSMLM?s.manifest.name=e.name.split(".")[0]+".smlm":s.manifest.name=e.name.split(".")[0]+".zip"),s.manifest.hash||s.update_hash(),i.channel=i.channel||"default",s.channels[i.channel]=s.channels[i.channel]||[],s.channels[i.channel].push(l),s.zipFile=null,s.uploaded=!1,console.log(l),n(r)}),o.src=r.target.result},o.onerror=function(e){r(e)},o.readAsDataURL(e)})}},{key:"import_text_table",value:function(e,t,i,a,n){var s=this;return console.log(t),("string"==typeof t||t instanceof String)&&(t=I[t]),new r.a(function(r,o){return t?"undefined"==typeof Worker?(console.log("Web Worker not available"),void o("Web Worker not available")):(l=new Worker("static/js/AsyncTextLoader.js"),console.log("loading..."),n({running:!0,running_status:"running "}),l.onmessage=function(t){var d=t.data;if(d.error)o(d.error),l.terminate();else if(d.loaded){console.log(d.tableDict),console.log("done",d.statshtml,d);var m=JSON.parse(y()(N));d.name=e.name,d.file_size=e.size,m.name=e.name,m.type="table",m.rows=d.rows,m.min=d.min,m.max=d.max,m.avg=d.avg,m.offset={x:0,y:0},m.data=d;var c=s.calculate_hash(m);m.hash=c,d.file_hash=c,m.tags=i.tags||[],m.pixel_size=i.pixel_size,a?s.files.push(m):(s.manifest=JSON.parse(y()(U)),s.formats=s.manifest.formats,s.files=s.manifest.files,s.files.push(m)),s.manifest.name&&""!=s.manifest.name||(s.manifest.name=e.name.split(".")[0]+".smlm"),s.manifest.hash||s.update_hash(),i.channel=i.channel||"default",s.channels[i.channel]=s.channels[i.channel]||[],s.channels[i.channel].push(d),s.zipFile=null,s.uploaded=!1,s.isSMLM=!0,l.terminate(),console.log(d),r(m)}else d.progress&&n({running_progress:d.progress,running_status:(d.localization_num/1e6).toFixed(1)+"M localizations loaded"})},l.onerror=function(){console.log("load error"),o("error occured during running."),l.terminate()},void l.postMessage({file:e,format:t})):(console.log("no table format not found.",t),void o("no table format not found."));var l})}},{key:"import_smlm",value:function(e,t,i){var a=this;if(t)throw"please load smlm file first, append mode is not supported yet.";return new r.a(function(t,n){JSZip.loadAsync(e).then(function(s){i({running:!0});var o=s.file("manifest.json");o?o.async("string").then(function(o){var d=JSON.parse(o),c=d.format_version;i({running_status:"manifest file loaded."});var _,h={};(_=m()(l.a.mark(function t(){var n,o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=l.a.mark(function t(n){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new r.a(function(t,r){var o=d.files[n];if("table"==o.type){i({running_status:"loading smlm file..."});var l=s.file(o.name),m=o.format;if(i({running_status:"uncompressing file: "+o.name}),!l&&d.formats[m])return void r("table file "+d.table_file+" is not present in the zip file");var _=d.formats[m];l.async("blob").then(function(n){console.log(n);var s=new FileReader;s.onload=function(n){i({running_status:"table loaded."});for(var s=n.target.result,l=new Uint8Array(s),d=o.rows,m=_.columns,u=0;u<m;u++)_.headers[u].startsWith("_")&&(_.headers[u]=_.headers[u].slice(1));if(l.length!=d*m*4)return console.error("file size mismatch: ",l.length,d*m*4),void r("file size does not match the manifest.");for(var p=[],g=[],v=0;v<m;v++)p[v]=new Uint8Array(new ArrayBuffer(4*d));if(1==c)for(var w=0;w<m;w++)for(var x=0;x<4*d;x++)p[w][x]=l[x*m+w];else for(var b=0;b<m;b++)for(var y=0;y<d;y++)p[b][4*y]=l[y*m*4+4*b],p[b][4*y+1]=l[y*m*4+4*b+1],p[b][4*y+2]=l[y*m*4+4*b+2],p[b][4*y+3]=l[y*m*4+4*b+3];for(var k={},S={},F=0;F<m;F++)g[F]=new Float32Array(p[F].buffer),k[_.headers[F]]=g[F],S[_.headers[F]]=p[F];o.min={},o.max={},o.avg={},d=g[0].length;for(var C=0;C<m;C++){var A=_.headers[C];o.min[A]=Number.POSITIVE_INFINITY,o.max[A]=Number.NEGATIVE_INFINITY,o.avg[A]=0;for(var T=0;T<d;T++)o.min[A]>g[C][T]&&(o.min[A]=g[C][T],0==g[C][T]&&console.log(A,C,T)),o.max[A]<g[C][T]&&(o.max[A]=g[C][T]),o.avg[A]+=g[C][T]/d}h.headers=_.headers;for(var E=0;E<h.headers.length;E++)h.headers[E]=h.headers[E].replace(/[^a-zA-Z0-9]+/g,"_").trim();h.min=o.min,h.max=o.max,h.avg=o.avg,h.file_name=o.name,h.file_size=e.size,h.tableUint8Arrays=p,h.tableArrays=g,h.tableUint8Dict=S,h.tableDict=k,h.columns=m,f()(h,o),o.data=h,o.data.integrity_test=!1;var z=a.calculate_hash(o);o.hash&&o.hash==z?(o.data.integrity_test=!0,console.log("integrity test passed: hash = "+z)):(o.data.integrity_test=!1,console.log("integrity test failed: hash "+o.hash+" != "+z)),o.hash=z,h.file_hash=z,t()},s.onerror=function(e){r(e)},s.readAsArrayBuffer(n)}).catch(function(e){r(e)})}else if("image"==o.type){i({running_status:"loading image file..."});o.format;var u=s.file(o.name);if(!u)return void r("image file "+d.image_file+" is not present in the zip file.");i({running_status:"uncompressing file: "+o.name}),u.async("blob").then(function(i){var a=new FileReader;a.onload=function(a){var n=new Image;n.addEventListener("load",function(){var a={};a.image=n,a.name=o.name||e.name,a.file_name=o.name||e.name,a.file_size=i.size||e.size,a.file_hash=o.hash,o.data=a,t()}),n.src=a.target.result},a.onerror=function(e){r(e)},a.readAsDataURL(i)})}});case 2:case"end":return t.stop()}},t,a)}),o=0;case 2:if(!(o<d.files.length)){t.next=7;break}return t.delegateYield(n(o),"t0",4);case 4:o++,t.next=2;break;case 7:case"end":return t.stop()}},t,a)})),function(){return _.apply(this,arguments)})().then(function(){a.formats=d.formats,a.files=d.files,a.manifest=d,a.manifest.tags=a.manifest.tags||[],a.update_hash(),a.zipFile=null,a.uploaded=!1,a.isSMLM=!0,t(a.files)}).catch(function(e){n(e)})}).catch(function(e){n(e)}):n("manifest.json is not present in the zip file")})})}},{key:"calculate_hash",value:function(e){console.log("calculating md5 for ",e.name);var t=new SparkMD5.ArrayBuffer;if("table"==e.type){var i=e.data.tableDict;i.frame&&t.append(i.frame.buffer),i.x&&t.append(i.x.buffer),i.y&&t.append(i.y.buffer)}else if("image"==e.type){var a=e.data.image.src,n=this.dataURItoArrayBuffer(a);t.append(n)}var s=t.end();return console.log(e.name," hash: ",s),s}},{key:"update_hash",value:function(){for(var e=new SparkMD5,t=0;t<this.files.length;t++)this.files[t].hash?e.append(this.files[t].hash):e.append(this.files[t].name);this.manifest.hash=e.end(),console.log("update smlm file hash, name: ",this.manifest.name+" md5: "+this.manifest.hash)}},{key:"dataURItoArrayBuffer",value:function(e){for(var t=atob(e.split(",")[1]),i=(e.split(",")[0].split(":")[1].split(";")[0],new ArrayBuffer(t.length)),a=new Uint8Array(i),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return i}},{key:"dataURItoFile",value:function(e,t){for(var i=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(i.length),s=new Uint8Array(n),r=0;r<i.length;r++)s[r]=i.charCodeAt(r);var o=new Blob([n],{type:a}),l=t.split(".")[0]+"."+(a.split("/")[1]||"png");return new File([o],l)}},{key:"save",value:function(e){var t=this;return console.log("preparing .smlm file"),new r.a(function(i,a){try{if(t.zipFile)return void i(t.zipFile);var n=new JSZip;e({running:!0,running_progress:0,running_status:"Preparing a compressed smlm file..."});for(var s=0;s<t.files.length;s++){var r=t.files[s];if("table"==r.type){for(var o=JSON.parse(y()(W["smlm-table(binary)"])),l=o.name+"-"+s,d=t.files[s].data,m=d.tableDict,c=[],_=0;_<d.headers.length;_++)c.push(new Uint8Array(m[d.headers[_]].buffer));var h=c[0].length/4,u=c.length;o.name=l,r.format=l,t.formats[l]=o,r.name=d.file_name.split(".")[0]+o.extension,r.hash=t.calculate_hash(r),o.columns=u;for(var p=0;p<d.headers.length;p++)o.dtype[p]="float32",o.shape[p]=1,o.headers[p]=d.headers[p].replace(/'/g,"").replace(/"/g,"").replace(/[^a-zA-Z0-9]+/g,"_").trim(),o.headers[p].startsWith("_")&&(o.headers[p]=o.headers[p].slice(1));console.log("preparing table ",r.name);var g=new ArrayBuffer(h*u*4),v=new Uint8Array(g);console.log("binary file size: "+h*u*4);for(var w=0;w<u;w++)for(var x=0;x<h;x++)v[x*u*4+4*w]=c[w][4*x],v[x*u*4+4*w+1]=c[w][4*x+1],v[x*u*4+4*w+2]=c[w][4*x+2],v[x*u*4+4*w+3]=c[w][4*x+3];var b=new Blob([v]),k=new File([b],r.name,{type:"application/octet-stream",lastModified:Date.now()});console.log("file is ready.",k),console.log("preparing file for upload..."),n.file(r.name,k)}else if("image"==r.type){var S=t.files[s].data,F=S.image.src,C=t.dataURItoFile(F,S.file_name);r.hash=t.calculate_hash(r),n.file(C.name,C)}}var A=f()({},t.manifest);A.format_version=U.format_version;for(var T=[],E=0;E<t.manifest.files.length;E++){var z=f()({},t.manifest.files[E]);delete z.data,T.push(z)}A.files=T,t.update_hash(),console.log("smlm manifest: ",A),n.file("manifest.json",y()(A,null,"\t")),console.log("making zip archive..."),n.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}},function(t){e({running_status:"making zip files... ",running_progress:t.percent})}).then(function(e){var a=t.manifest.name,n=new File([e],a,{type:"application/smlm",lastModified:Date.now()});console.log(n),t.zipFile=n,i(n)}).catch(function(e){console.error(e),a(e)})}catch(e){return console.error(e),void a(e)}})}}]),e}(),R={png:{type:"image",extension:".png",mode:"binary"},jpg:{type:"image",extension:".jpg",mode:"binary"},jpeg:{type:"image",extension:".jpeg",mode:"binary"}},I={"ThunderSTORM (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:",",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","uncertainty_xy [nm]":"uncertainty_xy","uncertainty_z [nm]":"uncertainty_z"},name:"ThunderSTORM (csv)",description:"a csv format used in thunderSTORM"},"ThunderSTORM (xls)":{type:"table",extension:".xls",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","uncertainty_xy [nm]":"uncertainty_xy","uncertainty_z [nm]":"uncertainty_z"},name:"ThunderSTORM (xls)",description:"a xls format used in thunderSTORM"},"ZEISS (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{"Position X [nm]":"x","Position Y [nm]":"y","Position Z [nm]":"z","First Frame":"frame"},name:"ZEISS (txt)",description:"a txt format used in ZEISS microscope"},"ZEISSv1 (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:";",comments:"",header_row:0,header_transform:{"Position X [nm]":"x","Position Y [nm]":"y","Position Z [nm]":"z","First Frame":"frame"},name:"ZEISSv1 (csv)",description:"a csv format used in ZEISS microscope"},"ZEISSv2 (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:";",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","First Frame":"frame"},name:"ZEISSv2 (csv)",description:"a csv format used for ZEISS microscope"},"RapidSTORM (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:" ",comments:"",header_row:0,header_transform:{"*all*":'identifier="([\\w\\d\\-_]+)"',"Position-0-0":"x","Position-1-0":"y","Position-2-0":"z","ImageNumber-0-0":"frame"},name:"RapidSTORM (txt)",description:"a text format used in RapidSTORM"},"Space Seperated List (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:" ",comments:"",header_row:0,header_transform:{},name:"Space Seperated List (txt)",description:"A list of coordinates seperated with space."},"Nikon NSTORM (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{X:"x",Y:"y",Z:"z",Frame:"frame"},name:"Nikon NSTORM (txt)",description:"a txt format exported from Nikon NSTORM software"}},W={"smlm-table(binary)":(u={name:"smlm-table(binary)",type:"table",mode:"binary",extension:".bin",columns:0,headers:[],dtype:[],shape:[],units:[]},h()(u,"name","smlm-table(binary)"),h()(u,"description","the default smlm format for localization tables"),u),"smlm-image(binary)":{type:"image",mode:"binary",extension:".raw",dtype:"uint32",shape:[512,512,null],offset:0,name:"smlm-image(binary)",description:"a format for 32-bit raw pixel image"},"smlm-table(csv)":{type:"table",mode:"text",extension:".csv",dtype:"float32",delimiter:",",comments:"#",header_row:0,header_transform:{},name:"smlm-table(csv)",description:"a format for export as csv format"}},U={format_version:"0.2",formats:{},files:[],tags:[],name:"",description:"",sample:"",labeling:""},N={name:"",format:"smlm-table(binary)",channel:"default",rows:0,offset:{},metadata:{},exposure:-1},O={"shader-particle-renderer-vs":{type:"x-shader/x-vertex",source:"#ifdef GL_ES\n  precision mediump float;\n  #endif\n  attribute vec2 uv;\n\n  uniform sampler2D sampler_particles;\n\n  uniform vec2 viewSize;\n  uniform vec4 scale;\n  uniform vec4 color1;\n  uniform vec2 clipX;\n  uniform vec2 clipY;\n  uniform vec2 clipZ;\n\n  uniform mat4 projectionMatrix;\n  uniform mat4 modelViewMatrix;\n\n  uniform float fov;\n  uniform vec3 camera;\n  uniform float pointSizeMin;\n  uniform float pointSizeMax;\n\n  varying vec4 col;\n  varying float alphaFactor;\n\n  void main() {\n  \tvec4 pos = texture2D(sampler_particles, uv);\n  \tbool isVisible = clipX.x - 0.5 <= pos.x && pos.x <= clipX.y - 0.5 && clipY.x - 0.5 <= pos.y && pos.y <= clipY.y - 0.5 && clipZ.x - 0.5 <= pos.z && pos.z <= clipZ.y - 0.5;\n  \tpos.xyz += -vec3(clipX.x + clipX.y, clipY.x + clipY.y, clipZ.x + clipZ.y)*0.5 + 0.5;\n  \tpos.xyz *= scale.xyz;\n\n  \tfloat distance = length(camera-(modelViewMatrix * pos).xyz);\n  \tgl_PointSize = scale.w*fov/distance*viewSize.y/2048.;\n\n  \talphaFactor = 1.;\n  \tif(gl_PointSize < 1.){\n  \t\talphaFactor = max(gl_PointSize, 1./16.);\n  \t}\n\n  \tcol = color1;\n\n  \tpos.w = 1.;\n  \tgl_Position = projectionMatrix  * modelViewMatrix * pos;\n\n  \tif(!isVisible){\n  \t\tcol.a = 0.;\n  \t}}"},"shader-vs":{type:"x-shader/x-vertex",source:"#ifdef GL_ES\n    precision mediump float;\n    #endif\n    attribute vec3 aPos;\n    attribute vec2 aTexCoord;\n    varying   vec2 uv;\n    varying vec2 uv_orig;\n    void main(void) {\n    \t gl_Position = vec4(aPos, 1.);\n    \t uv = aTexCoord;\n    \t uv_orig = uv;\n    }"},"shader-particle-renderer-fs":{type:"x-shader/x-fragment",source:"#ifdef GL_ES\n    precision mediump float;\n    #endif\n    varying vec4 col;\n    varying float alphaFactor;\n\n    void main() {\n    \tgl_FragColor = col;\n    \tgl_FragColor.a *= alphaFactor;\n    }"}};function P(e,t){var i,a=O[t];if("x-shader/x-fragment"==a.type)i=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=a.type)return null;i=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(i,a.source),e.compileShader(i),0==e.getShaderParameter(i,e.COMPILE_STATUS)&&alert("error compiling shader '"+t+"'\n\n"+e.getShaderInfoLog(i)),i}var j,B,$,V,Z,H,Y,X,G,q=512,K=512,J=1024,Q=512,ee=J,te=Q,ie=0,ae=(new Date).getTime(),ne=function(){this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.pointSize=1,this.distance=4,this.fov=16,this.pointSizeMin=0,this.pointSizeMax=12};function se(){ee=window.innerWidth,te=window.innerHeight,G.width=ee,G.height=te;var e=ee/te;B=new THREE.PerspectiveCamera(75,e,.1,1e4),$=new THREE.Scene,V=new THREE.Object3D,$.add(B),$.add(V),B.lookAt(V),ke(),Z=new THREE.TrackballControlsWithPropagation(B,G),V.position.set(0,0,0),B.position.set(0,0,Y.distance),B.fov=Y.fov,B.projectionMatrix=(new THREE.Matrix4).makePerspective(B.fov,window.innerWidth/window.innerHeight,B.near,B.far),Z.rotateSpeed=1,Z.zoomSpeed=1.2,Z.panSpeed=.8,Z.dynamicDampingFactor=.15}var re=!1;function oe(){ve=0,Y["Total # of locations"]=0;for(var e=0;e<Ce.length;e++){Y["active "+e]&&Y["alpha "+e]>0&&(ve+=Fe[Ce[e]].locations.numChunks,Y["Total # of locations"]+=Fe[Ce[e]].locations.rows);var t=Y["color "+e];if("string"==typeof t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);Y["color "+e]=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}}re=!0}function le(e,t){X=t,Y=new ne,H=new dat.GUI({autoPlace:!1}),document.getElementById("gui-webgl").appendChild(H.domElement),Y["Total # of locations"]=0,Y["reset scale"]=function(){Y.x=1,Y.y=1,Y.z=1,Y["point size"]=3,re=!0},Y["reset scale"]();var i=H.addFolder("Scale (x10)");i.add(Y,"x",0,10).listen().onChange(oe),i.add(Y,"y",0,10).listen().onChange(oe),i.add(Y,"z",0,10).listen().onChange(oe),i.add(Y,"point size",0,20).listen().onChange(oe),i.add(Y,"reset scale"),Y["reset clipping"]=function(){Y["x min"]=0,Y["x max"]=1,Y["y min"]=0,Y["y max"]=1,Y["z min"]=0,Y["z max"]=1,re=!0},Y["reset clipping"]();var a=H.addFolder("Clipping");a.add(Y,"x min",0,1).listen().onChange(oe),a.add(Y,"x max",0,1).listen().onChange(oe),a.add(Y,"y min",0,1).listen().onChange(oe),a.add(Y,"y max",0,1).listen().onChange(oe),a.add(Y,"z min",0,1).listen().onChange(oe),a.add(Y,"z max",0,1).listen().onChange(oe),a.add(Y,"reset clipping"),H.add(Y,"Total # of locations").listen(),G=e;try{A=G.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0})}catch(e){}if(A)if(["OES_texture_float"].forEach(function(e){console.log("check "+e);try{T=A.getExtension(e)}catch(e){alert(e)}T?T=!1:alert("Meh! Y u no support "+e+" !?!")}),0!=A.getParameter(A.MAX_VERTEX_TEXTURE_IMAGE_UNITS)){Fe=[],Ce=[],document.addEventListener("orientationchange",window.onresize=se),G.addEventListener("wheel",ze,!1),se(),A.bindBuffer(A.ARRAY_BUFFER,A.createBuffer());var n=1/512,s=new ArrayBuffer(4194304);s.float32=new Float32Array(s);for(var r=0;r<512;r++)for(var o=0;o<512;o++)s.float32[2*(512*r+o)+0]=n/2+o*n,s.float32[2*(512*r+o)+1]=n/2+r*n;var l=new ArrayBuffer(4194304);l.float32=new Float32Array(l),z=A.createFramebuffer(),M=de(l.float32,z);E=function(e){var t=A.createProgram();return A.attachShader(t,P(A,"shader-particle-renderer-vs")),A.attachShader(t,P(A,"shader-particle-renderer-fs")),A.bindAttribLocation(t,e,"uv"),A.linkProgram(t),t}(1),A.useProgram(E),A.uniform1i(A.getUniformLocation(E,"sampler_particles"),0),A.enableVertexAttribArray(1),j=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,j),A.bufferData(A.ARRAY_BUFFER,s.float32,A.STATIC_DRAW),A.vertexAttribPointer(1,2,A.FLOAT,!1,8,0),setInterval(Ee,1e3),(new Date).getTime()-ae,A.blendFunc(A.SRC_ALPHA,A.ONE),A.blendEquation(A.FUNC_ADD),A.clearColor(0,0,0,1),ge()}else alert("Meh! Y u no support vertex shader textures !?!");else alert("Meh! Y u no support WebGL !?!")}function de(e,t){var i=A.createTexture();return A.bindTexture(A.TEXTURE_2D,i),A.pixelStorei(A.UNPACK_ALIGNMENT,1),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,q,K,0,A.RGBA,A.FLOAT,e),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.bindFramebuffer(A.FRAMEBUFFER,t),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,i,0),fe(),i}var me=!1;function ce(){me=!0}function fe(){var e=A.checkFramebufferStatus(A.FRAMEBUFFER);if(e!=A.FRAMEBUFFER_COMPLETE)for(var t in console.log("Framebuffer, y u not completed yet!?"),A)"number"==typeof A[t]&&A[t]==e&&console.log("-> "+t)}var _e=new Float32Array(16),he=0,ue=new Float32Array(16),pe=!0;function ge(e){pe,pe=!0;for(var t=0;t<16;t++)pe=pe&&_e[t]-B._projectionMatrixArray[t]==0&&ue[t]-B._viewMatrixArray[t]==0;(pe=pe&&B.fov==he)||(he=B.fov,_e.set(B._projectionMatrixArray),ue.set(B._viewMatrixArray)),function(){if(me){var e=Fe[Ce[Ce.length-1]].locations;A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,M),A.bindFramebuffer(A.FRAMEBUFFER,z),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,q,K,0,A.RGBA,A.FLOAT,e.stridedFloat32Arrays[1]),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,M,0),oe()}}(),Z.update(),ke(),function(){A.viewport(0,0,ee,te),A.bindFramebuffer(A.FRAMEBUFFER,null);(re||!pe||me)&&(A.clear(A.COLOR_BUFFER_BIT),A.flush(),xe=-1);if(pe&&-1==xe&&!me&&!re||0==ve)return void(re=!1);re=!1,A.bindBuffer(A.ARRAY_BUFFER,j),A.useProgram(E),function(e){A.uniform2f(A.getUniformLocation(e,"viewSize"),ee,te),A.uniform2f(A.getUniformLocation(e,"aspect"),Math.max(1,ee/te),Math.max(1,te/ee)),A.uniform4f(A.getUniformLocation(e,"scale"),Y.x,Y.y,Y.z,Y["point size"]);var t=Math.min(Y["x min"],Y["x max"]),i=Math.max(Y["x min"],Y["x max"]);A.uniform2f(A.getUniformLocation(e,"clipX"),t,i);var a=Math.min(Y["y min"],Y["y max"]),n=Math.max(Y["y min"],Y["y max"]);A.uniform2f(A.getUniformLocation(e,"clipY"),a,n);var s=Math.min(Y["z min"],Y["z max"]),r=Math.max(Y["z min"],Y["z max"]);A.uniform2f(A.getUniformLocation(e,"clipZ"),s,r),A.uniform1f(A.getUniformLocation(e,"fov"),1/Math.tan(Y.fov/180*Math.PI)),A.uniform3f(A.getUniformLocation(e,"camera"),0,0,Y.distance),A.uniform1i(A.getUniformLocation(e,"sampler_particles"),1)}(E),A.uniformMatrix4fv(A.getUniformLocation(E,"projectionMatrix"),!1,B._projectionMatrixArray),A.uniformMatrix4fv(A.getUniformLocation(E,"modelViewMatrix"),!1,B._viewMatrixArray),A.enable(A.BLEND),A.activeTexture(A.TEXTURE1);var e=0;e:for(var t=0;t<Ce.length;t++){var i=Fe[Ce[t]],a=i.locations.numChunks-1,n=Y["color "+t],s=Y["alpha "+t],r=Y["active "+t]&&s>0;if(r){A.uniform4f(A.getUniformLocation(E,"color1"),n[0]/255,n[1]/255,n[2]/255,s);for(var o=0;o<i.locations.numChunks;o++){if(e>xe){if(!(e<=xe+we&&e<ve)){xe=e-1;break e}var l=i.locations.textures[o];A.bindTexture(A.TEXTURE_2D,l);var d=i.locations.bufferLength;o==a&&(d=i.locations.rows-i.locations.bufferLength*a,xe=-1),A.drawArrays(A.POINTS,0,d)}e++}}}A.disable(A.BLEND),A.flush()}(),e&&function(e){var t=e-ye;if(ye=e,pe)return;t<1e3/be?we+=.25:we-=.25;we=Math.max(we,0),we=Math.min(we,ve)}(e),requestAnimationFrame(ge),me=!1,ie++,0}var ve=0,we=0,xe=-1,be=24,ye=0;function ke(){$.updateMatrixWorld(),B.matrixWorldInverse.getInverse(B.matrixWorld),B._viewMatrixArray||(B._viewMatrixArray=new Float32Array(16)),B.matrixWorldInverse.flattenToArray(B._viewMatrixArray),B._projectionMatrixArray||(B._projectionMatrixArray=new Float32Array(16)),B.projectionMatrix.flattenToArray(B._projectionMatrixArray),V.__webglInit||(V._modelViewMatrix=new THREE.Matrix4,V._objectMatrixArray=new Float32Array(16),V._modelViewMatrixArray=new Float32Array(16)),V.matrixWorld.flattenToArray(V._objectMatrixArray),V._modelViewMatrix.multiplyToArray(B.matrixWorldInverse,V.matrixWorld,V._modelViewMatrixArray)}var Se=[[0,255,0],[255,0,255],[0,0,255]],Fe=[],Ce=[];function Ae(e){return e.hash&&e.hash.length>5?e.hash:e.name+"."+e.size}function Te(e,t){for(var i=Date.now(),a=["x","y","z"],n=[],s=[],r=e.tableDict,o=e.isFiltered,l=o?Math.ceil(e.filteredRows/262144):Math.ceil(e.rows/262144),d=0;d<l;d++)n[d]=new ArrayBuffer(4194304),s[d]=new Float32Array(n[d]);var m=Math.max(e.max[a[0]]-e.min[a[0]],e.max[a[1]]-e.min[a[1]],e.max[a[2]]-e.min[a[2]]),c=(e.max[a[0]]-e.min[a[0]])/2,f=(e.max[a[1]]-e.min[a[1]])/2,_=(e.max[a[2]]-e.min[a[2]])/2;t&&t({rendering:!0,rendering_progress:0,rendering_status:"normalize into strided array chunks"});for(var h=-1,u=0,p=0;p<e.rows;p++){var g=Math.floor(100*p/(e.rows+1));if(g!=h&&(h=g,t&&t({rendering_progress:h})),!o||o[p]){var v=u-262144*(d=Math.floor(u/262144)),w=s[d];w[4*v+0]=(r[a[0]][p]-c)/m,w[4*v+1]=(r[a[1]][p]-f)/m,w[4*v+2]=(r[a[2]][p]-_)/m,w[4*v+3]=1,u+=1}}t&&t({rendering_status:"normalize into strided array chunks [ms]: "+(Date.now()-i)});var x={file_hash:e.file_hash,filteredRows:e.filteredRows,file_name:e.file_name,file_size:e.file_size,bufferLength:262144,numChunks:l,rows:e.rows,headers:e.headers,stridedArrayBuffers:n};console.log("normalize into strided array chunks [ms]: "+(Date.now()-i),x),function(e){if(e){var t={hash:e.file_hash,name:e.file_name,size:e.file_size},i=Ae(t),a=Ce.indexOf(i);a>=0&&(t=Fe[i]),e.stridedFloat32Arrays=[],e.textures=[];for(var n=0;n<e.numChunks;n++)e.stridedFloat32Arrays[n]=new Float32Array(e.stridedArrayBuffers[n]),e.textures[n]=de(e.stridedFloat32Arrays[n],z);if(console.log(Fe),t.locations=e,ve+=e.numChunks,a>=0)ce();else{!function(e){var t=Ae(e);Fe[t]=e,Ce.push(t)}(t),ce();var s=Ce.length%Se.length;if(e.numChunks>0){var r=H.addFolder(e.file_name+" (#"+e.filteredRows+")"),o=Ce.indexOf(i),l="active "+o,d="color "+o,m="alpha "+o;Y[l]=!0,Y[d]=Se[s],Y[m]=.9,r.add(Y,l).onChange(oe),r.addColor(Y,d).onChange(oe),r.add(Y,m,0,1).onChange(oe),r.open()}console.log(Fe,Ce),console.log("locations uploaded to WebGL textures:"),console.log(e)}we=ve}else console.log("something went wrong")}(x),t({rendering_status:"3D view rendered(loc.:"+e.filteredRows+", file:"+e.file_name+").",rendering_progress:100,rendering:!1})}function Ee(){Y.Fps=ie,H.__controllers[0].updateDisplay(),X&&X({fps:pe?0:ie,ppf:pe?0:Math.floor(we)+" x 256k"}),ie=0}function ze(e){e.preventDefault(),e.stopPropagation();return B.fov-=.0033*e.wheelDeltaY,B.fov=Math.max(Math.min(B.fov,130),1),B.projectionMatrix=(new THREE.Matrix4).makePerspective(B.fov,window.innerWidth/window.innerHeight,B.near,B.far),Y.fov=B.fov,!1}var Me=i("iW7V")();var De={name:"viewer",props:["title"],data:function(){var e;return e={selected_s3_file:null,selected_smlm_file_hash:null,selected_smlm_file:null,filter_enabled:!1,expandActions:!1,menuVisible:!1,show_filter:!1,use_lut:!0,use_3d:!1,localizationNumber:0,frameNumber:0,histogram_image:null,rendering_status:"",rendering_progress:0,filter_expression:"",filter_tooltip:"",histogram_width:2560,histogram_height:2560,filter_ranges:{},selected_filter:null,selected_filter_max:0,selected_filter_min:0,rendering:!1,rendered:!1,render3d_loaded:!1,export_histogram_png:null,map:null,fps:0,ppf:0,selected_file:null,renderWorker:null,filterWorker:null,hist_table:[],options:null,showInfoDialog:!1,showShareDialog:!1,showFilesDialog:!1,showErrorDialog:!1,error_content:"error occured.",text_file_format:"",running_status:"",running:!1,running_progress:0},h()(e,"running",!1),h()(e,"smlm",null),h()(e,"channel_name","default"),h()(e,"pixel_size",20),h()(e,"offset_x",0),h()(e,"offset_y",0),h()(e,"offset_mode","min-max"),h()(e,"running_progress",0),h()(e,"selected_channel",0),h()(e,"tags",[]),h()(e,"metadata",{}),h()(e,"show_more_import_options",!1),h()(e,"append_mode",!1),h()(e,"showImportDialog",!1),h()(e,"get_shared_link",!0),h()(e,"make_public",!1),h()(e,"licenses",["CC BY 4.0","CC BY-NC 4.0","CC BY-SA 4.0","CC BY-ND 4.0"]),h()(e,"shared_link",""),h()(e,"showSharedLink",!1),h()(e,"loaded_sample",null),h()(e,"loading_shared_url",!1),h()(e,"shared_url_mode",!1),h()(e,"showProcessDialog",!1),h()(e,"openFilesCount",0),h()(e,"anet_running",!1),h()(e,"anet_taskid",null),h()(e,"screenWidth",0),h()(e,"show_anet_output",!1),h()(e,"anet_output_available",!1),h()(e,"anet_output_img",null),h()(e,"anet_output_sample_hash",null),h()(e,"current_render2d_config",{brightness:1}),h()(e,"hist_render2d_config",{brightness:1}),h()(e,"anet_render2d_config",{brightness:1}),h()(e,"supported_file_formats",{}),h()(e,"file_sample_lines",""),h()(e,"use_widefield",!1),h()(e,"widefield_available",!1),h()(e,"worker_list",[]),h()(e,"worker_validation_msg",null),h()(e,"file_tags",[]),h()(e,"selected_worker",null),h()(e,"selected_worker_uri",null),h()(e,"loading_worker_list",!1),h()(e,"leafletMap",null),h()(e,"_canvas_layer",null),h()(e,"_canvas_data",null),h()(e,"current_displaying",null),h()(e,"show140",!1),h()(e,"support140",!0),h()(e,"showUploading",!1),h()(e,"store",this.$root.$data.store),h()(e,"api",this.$root.$data.store.api),h()(e,"snackbar_info",""),h()(e,"showSnackbar",!1),h()(e,"snackbar_duration",3e3),e},watch:{menuVisible:function(){var e=this;setTimeout(function(){e.$refs["filter-slider"]&&e.$refs["filter-slider"].refresh(),e.$refs["brightness-slider"]&&e.$refs["brightness-slider"].refresh(),e.leafletMap.invalidateSize(),e.$forceUpdate()},800)}},mounted:function(){var e=this;this.screenWidth=window.innerWidth,this.store.event_bus.$on("resize",function(t){e.screenWidth=t.width,console.log("window size changed.",t.width),t.width>1e3&&!e.menuVisible&&e.options?e.menuVisible=!0:t.width<=1e3&&e.menuVisible&&(e.menuVisible=!1)}),this.api.show=this.show,this.supported_file_formats={},f()(this.supported_file_formats,{"SMLM format":{}}),f()(this.supported_file_formats,I),f()(this.supported_file_formats,R),this.filterWorker=new Worker("static/js/AsyncFilter.js"),this.renderWorker=new Worker("static/js/AsyncRenderer.js"),this.$route.query.file&&this.loadSample(this.$route.query.file)},methods:{show:function(e,t){this.snackbar_info=e,this.snackbar_duration=t||3e3,this.showSnackbar=!0},workerSelected:function(e){this.selected_worker=null;for(var t=0;t<this.worker_list.length;t++)if(this.worker_list[t].uri==e){this.selected_worker=this.worker_list[t];break}},updateCanvas:function(){if(this.show_anet_output){this.current_render2d_config=this.anet_render2d_config;var e=this.anet_output_img,t=document.createElement("canvas");t.width=e.width,t.height=e.height,this.histogram_width=t.width,this.histogram_height=t.height;var i=t.getContext("2d");i.drawImage(e,0,0);var a=i.getImageData(0,0,t.width,t.height);this.render_canvas(a,this.current_render2d_config.brightness)}else this.current_render2d_config=this.hist_render2d_config,this.render_canvas(null,this.current_render2d_config.brightness)},shareFile:function(){var e=this;this.store.signed_in?this.generateThumbnail().then(function(){e.showShareDialog=!0,e.smlm&&(e.smlm.manifest.license=e.smlm.manifest.license||"CC BY 4.0")}).catch(function(t){console.error(t),e.api.show("something went wrong.",5e3),e.error_content="Failed to share this sample, something went wrong.",e.showErrorDialog=!0}):this.api.showLogin()},openFilesChange:function(e,t){t.length&&console.log(e,t)},getFileExtension:function(e){return/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:void 0},loadSample:function(e){var t=this;return m()(l.a.mark(function i(){var a,n,s;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,t.loading_shared_url=!0,t.shared_url_mode=!0,t.running=!0,i.next=6,w()({url:e,method:"GET",responseType:"blob",onDownloadProgress:function(e){t.running_status="Downloading "+e.loaded+"/"+e.total,e.total&&(t.running_progress=e.loaded/e.total*100),t.$forceUpdate()}});case 6:a=i.sent,n=a.data,s=n.name||e.split("/").pop(),t.selected_file_name=s,t.selected_file=n,"application/zip"==n.type||"application/smlm"==n.type||s&&s.endsWith(".smlm")?t.loadSmlm():t.loadFile(),i.next=17;break;case 14:i.prev=14,i.t0=i.catch(0),alert("failed to load sample: "+i.t0);case 17:return i.prev=17,t.loading_shared_url=!1,i.finish(17);case 20:case"end":return i.stop()}},i,t,[[0,14,17,20]])}))()},loadSmlmFile:function(e){console.log("loading ...",e),this.file_tags=e.tags,"table"==e.type?(this.options=f()({xy_range:[0,0,0,0],pixel_size:this.pixel_size,frame_range:[0,0]},e.data),this.reset_filters(),this.filter_enabled=!0):"image"==e.type?(this.options={},this.plotImage(e.data.image)):console.error("file type not supported",e),this.selected_smlm_file_hash=e.hash,this.selected_smlm_file=e},generateThumbnail:function(e){var t=this;return new r.a(function(i,a){var n=null;if(t.use_3d)return t.api.show("Please switch to 2D mode to generate a thumbnail image for sharing."),void a();if(!t._canvas_data)return t.api.show("No data available."),void a();(n=document.createElement("canvas")).width=t.histogram_width,n.height=t.histogram_height,n.getContext("2d").putImageData(t._canvas_data,0,0);var s=document.createElement("canvas");s.width=e||192,s.height=s.width*(n.height/n.width),Me.resize(n,s,{unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2}).then(function(e){t.smlm.manifest.thumbnail=s.toDataURL(),i(t.smlm.manifest.thumbnail)}).catch(function(e){a(e)})})},switchChannel:function(e){console.log(e)},selectFile:function(e){this.append_mode=e,this.running_progress=0,this.$refs.select_file_input.click()},updateStatus:function(e){e.running&&(this.running=e.running),e.running_status&&(this.running_status=e.running_status),e.running_progress&&(this.running_progress=e.running_progress)},fileSelected:function(e){var t=this,i=e.target.files;if(console.log("file selected",i),i&&i.length>0)if(1==i.length?this.selected_file_name=i[0].name:this.selected_file_name=i[0].name+", "+i[1].name+" etc.",console.log(i),this.selected_file=i[0],this.selected_file_name.endsWith(".smlm")||"application/zip"==this.selected_file.type||"application/smlm"==this.selected_file.type)this.loadSmlm();else{var a=new FileReader,n=this.selected_file.slice(0,100);a.onload=function(e){t.file_sample_lines=e.target.result.split("\n").slice(0,2),t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes("\t")?t.text_file_format="ThunderSTORM (xls)":t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes(",")?t.text_file_format="ThunderSTORM (csv)":t.file_sample_lines[0].includes("Position X [nm]")&&t.file_sample_lines[0].includes("\t")?t.text_file_format="ZEISS (txt)":t.file_sample_lines[0].includes("Position X [nm]")&&t.file_sample_lines[0].includes(";")?t.text_file_format="ZEISSv1 (csv)":t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes(";")?t.text_file_format="ZEISSv2 (csv)":t.file_sample_lines[0].startsWith("#")&&t.file_sample_lines[0].includes("identifier=")?t.text_file_format="RapidSTORM (txt)":t.file_sample_lines[0].includes("x ")&&t.file_sample_lines[0].includes("y ")?t.text_file_format="Space Seperated List (txt)":t.file_sample_lines[0].includes("X\t")&&t.file_sample_lines[0].includes("\tY\t")&&t.file_sample_lines[0].includes("Channel Name")?t.text_file_format="Nikon NSTORM (txt)":t.selected_file_name.endsWith(".png")?t.text_file_format="png":t.selected_file_name.endsWith(".jpg")?t.text_file_format="jpg":t.selected_file_name.endsWith(".jpeg")?t.text_file_format="jpeg":console.log("file format is not recognized",t.selected_file.name),t.selected_file_name.endsWith(".png")||t.selected_file_name.endsWith(".jpg")||t.selected_file_name.endsWith(".jpeg")?t.tags=["#WF"]:t.tags=["#SR"],t.append_mode=!1,t.showImportDialog=!0},a.onerror=function(){t.show("can't read file",5e3)},a.readAsText(n)}},stopAnetProcess:function(){var e=this;this.anet_taskid&&this.store.session.call("org.imod.user.tasks.update_task",[this.anet_taskid,{closed:!0}],{},{disclose_me:!0}).then(function(t){e.api.show("task stopped.")}).catch(function(t){console.error(t),e.api.show(t.args[0])}),this.use_widefield=!1,this.anet_running=!1,this.showProcessDialog=!1,this.anet_output_sample_hash=null,this.anet_output_available=!1,this.show_anet_output=!1},uploadWidefieldImage:function(e,t){var i=this;return new r.a(function(a,n){if(i.widefield_available&&"image"==i.widefield_available.type){var s=i.widefield_available.data.file;console.log(i.widefield_available);var r=i.widefield_available,o={name:r.name,type:"image/png",tags:r.tags,hash:i.widefield_available.hash,sample_hash:e,sample_config:t};i.getUploadUrl(o).then(function(e){var t=e.url,n=e.key;t&&null!==t||!n?i.uploadFile(s,o,n,t).then(function(e){console.log("widefield uploaded"),a(e)}):(console.log("widefield already uploaded"),a(n))}).catch(function(e){console.log(e),i.api.show(e),n(e)})}else n()})},loadFile:function(){"SMLM format"==this.text_file_format?this.loadSmlm():this.selected_file_name.endsWith(".png")?this.loadImageFile("png"):this.selected_file_name.endsWith(".jpg")?this.loadImageFile("jpg"):this.selected_file_name.endsWith(".jpeg")?this.loadImageFile("jpg"):this.loadTextFile(this.text_file_format)},loadImageFile:function(e){var t=this;console.time("load image file");var i=this.append_mode&&this.smlm?this.smlm:new D,a={offset:{x:this.offset_x,y:this.offset_y},tags:this.tags,channel:this.channel_name,pixel_size:this.pixel_size};this.options=this.options||{},i.import_image(this.selected_file,e,a,this.append_mode,this.updateStatus).then(function(e){t.file_tags=e.tags,t.running=!1;var a=e.metadata;t.metadata=a,console.timeEnd("load image file"),t.rendering_status="image loaded",t.rendering_progress=100,t.rendering=!1,t.rendered=!0,t.api.show("image loaded.",3e3),t.smlm=i,t.loadSmlmFile(e),t.selected_filter=null,t.tags=t.smlm.manifest.tags.slice(),t.filter_enabled=!1}).catch(function(e){t.running=!1,console.log(e),t.api.show(e,5e3)})},plotImage:function(e){this.histogram_width=e.width,this.histogram_height=e.height;var t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,i.drawImage(e,0,0),this.histogram_image=t.toDataURL("image/png"),console.log("tags:",this.tags),this.tags.indexOf("#SR")>=0?this.current_displaying="hist":this.current_displaying="image";var a=i.getImageData(0,0,t.width,t.height);this.render_canvas(a)},loadTextFile:function(e){var t=this;console.time("load text file",e);var i=this.append_mode&&this.smlm?this.smlm:new D,a={offset:{x:this.offset_x,y:this.offset_y},tags:this.tags,channel:this.channel_name,pixel_size:this.pixel_size};i.import_text_table(this.selected_file,e,a,this.append_mode,this.updateStatus).then(function(e){t.file_tags=e.tags,t.running=!1,console.timeEnd("load text file"),console.log(e);var a=e.metadata;t.metadata=a,t.api.show("file loaded.",3e3),t.smlm=i,t.loadSmlmFile(e),t.tags=t.smlm.manifest.tags.slice(),t.filter_enabled=!0}).catch(function(e){t.running=!1,console.log(e),t.api.show(e,5e3)})},loadSmlm:function(){var e=this;console.time("load smlm file");var t=new D;this.append_mode=!1,t.import_smlm(this.selected_file,this.append_mode,this.updateStatus).then(function(i){e.running=!1,console.timeEnd("load zip file"),e.api.show("file loaded.",3e3),e.smlm=t,e.tags=e.smlm.manifest.tags.slice();var a=i[0];e.metadata=a.metadata,e.loadSmlmFile(a),e.filter_enabled=!0}).catch(function(t){e.running=!1,console.log(t),e.api.show(t,5e3),e.running_status=t})},downloadSmlmFile:function(){var e=this;this.renderWorker&&(this.renderWorker.terminate(),this.renderWorker=null),this.smlm.save(this.updateStatus).then(function(t){e.running=!1;var i=t.name;t.name.endsWith(".smlm")||t.name.endsWith(".zip")||(i=t.name+".smlm"),Object(x.saveAs)(t,i)}).catch(function(t){e.api.show(t)})},updateFPS:function(e){this.fps=e.fps,this.ppf=e.ppf},switch3DView:function(e){this.$forceUpdate(),e?this.options.tableDict.z?(this.render3d_loaded||(le(document.getElementById("histogram_canvas_3d"),this.updateFPS),this.render3d_loaded=!0),this.plotHist()):(this.api.show("no data found on z dimension.",4e3),this.use_3d=!1):this.plotHist()},update_selected_filter:function(){this.filter_expression="";for(var e=0;e<this.options.headers.length;e++)isFinite(this.filter_ranges[this.options.headers[e]][0])&&isFinite(this.filter_ranges[this.options.headers[e]][1])&&this.filter_ranges[this.options.headers[e]][1]!=this.filter_ranges[this.options.headers[e]][0]&&(this.filter_ranges[this.options.headers[e]][0]!=this.options.min[this.options.headers[e]]&&(this.filter_expression+=this.options.headers[e]+">="+this.filter_ranges[this.options.headers[e]][0]+" and "),this.filter_ranges[this.options.headers[e]][1]!=this.options.max[this.options.headers[e]]&&(this.filter_expression+=this.options.headers[e]+"<="+this.filter_ranges[this.options.headers[e]][1]+" and "));" and "==this.filter_expression.slice(-5)&&(this.filter_expression=this.filter_expression.slice(0,-5)),console.log("generated filter expression:",this.filter_expression),this.plotHist()},reset_filters:function(){for(var e=0;e<this.options.headers.length;e++)this.filter_ranges[this.options.headers[e]]=[Math.round(this.options.min[this.options.headers[e]]),Math.round(this.options.max[this.options.headers[e]])];this.options.headers.indexOf("frame")>=0&&this.switch_selected_filter("frame"),this.filter_expression="",this.hist_render2d_config.brightness=100,this.plotHist()},switch_selected_filter:function(e){if(console.log(e),this.selected_filter=e,!this.filter_ranges[e])for(var t=0;t<this.options.headers.length;t++)this.filter_ranges[this.options.headers[t]]=[this.options.min[this.options.headers[t]],this.options.max[this.options.headers[t]]];this.selected_filter_range=this.filter_ranges[e],this.selected_filter_min=this.options.min[e],this.selected_filter_max=this.options.max[e],console.log(this.filter_ranges)},updateRenderStatus:function(e){this.rendering_progress=e.rendering_progress||this.rendering_progress,this.rendering_status=e.rendering_status||this.rendering_status,this.rendering=e.rendering||this.rendering},plotHist:function(e){var t=this;return this.show_anet_output=!1,this.current_render2d_config=this.hist_render2d_config,e=e||this.options,console.log(e),!e.tableDict||e.headers.length<=0||e.tableArrays.length<=0?(console.log({canvas_img_data:canvas_img_data,options:e}),console.log("rendering error."),void this.api.show("something went wrong, data is not loaded.",5e3)):new r.a(function(i,a){t.rendering_progress=0,t.rendering_status="rendering",t.rendering=!0;var n=t.pixel_size||20;e.pixel_size=n,t.pixel_size=n;for(var s=[],r=0;r<e.headers.length;r++)s[r]=e.headers[r];t.filter_tooltip="you can use these variables in your filter: "+s.join(", ")+" , use random() to do random sampling.",console.log("max_frame_number",e.max.frame,"min_frame_number",e.min.frame),t.filter_ranges.x=t.filter_ranges.x||[e.min.x,e.max.x],t.filter_ranges.y=t.filter_ranges.y||[e.min.y,e.max.y],e.xy_range=[],e.xy_range[0]=Math.round(t.filter_ranges.x[0]/n),e.xy_range[1]=Math.round(t.filter_ranges.x[1]/n),e.xy_range[2]=Math.round(t.filter_ranges.y[0]/n),e.xy_range[3]=Math.round(t.filter_ranges.y[1]/n),t.histogram_width=Math.min(e.xy_range[1]-e.xy_range[0],2560),t.histogram_height=Math.min(e.xy_range[3]-e.xy_range[2],2560),e.histogram_width=t.histogram_width,e.histogram_height=t.histogram_height,e.filter_expression=t.filter_expression,e.offset_mode=t.offset_mode,console.log("filtering...",t.offset_mode);var o={file_name:e.file_name,file_size:e.file_size,file_id:e.file_id,tableDict:e.tableDict,rows:e.rows,xy_range:e.xy_range,offset_mode:t.offset_mode,histogram_width:e.histogram_width,histogram_height:e.histogram_height,pixel_size:e.pixel_size,filter_expression:e.filter_expression,min:e.min,max:e.max},l=t.filterWorker;if(!l){if("undefined"==typeof Worker)return console.log("Web Worker not available"),void t.api.show("Web Worker not available");l=new Worker("static/js/AsyncFilter.js"),t.filterWorker=l}l.onerror=function(e){console.log("filterWorker went wrong: ",e)},l.onmessage=function(a){if(a.data.progress&&(t.rendering=!0,t.rendering_progress=Math.round(a.data.progress)),a.data._options){if(a.data._options.tableDict&&e.tableDict)for(var n in a.data._options.tableDict)e.tableDict[n]=a.data._options.tableDict[n];a.data._options.isFiltered&&(e.isFiltered=a.data._options.isFiltered)}a.data.finished&&(console.log("finished filtering"),o.isFiltered=a.data.isFiltered,o.filteredRows=a.data.filteredRows,o.frameNumber=a.data.frameNumber,t.localizationNumber=o.filteredRows,t.frameNumber=o.frameNumber,console.log(o),t.use_3d?t.render3d(o).then(function(){i()}):t.render2d(o).then(function(){i()}),t.current_displaying="hist")},t.rendering_status="filtering...";var d=[];for(var m in o.tableDict)d.push(o.tableDict[m].buffer);l.postMessage({options:o},d)})},render2d:function(e){var t=this;return new r.a(function(i,a){var n=t.renderWorker;if(!n){if("undefined"==typeof Worker)return console.log("Web Worker not available"),void t.api.show("Web Worker not available");n=new Worker("static/js/AsyncRenderer.js"),t.renderWorker=n}var s=document.createElement("canvas");s.width=t.histogram_width,s.height=t.histogram_height;var r=s.getContext("2d"),o=r.getImageData(0,0,s.width,s.height);n.onerror=function(e){console.log("renderWorker went wrong: ",e),t.rendered=!0,t.rendering=!1,t.rendering_status="error ocurred: "+e.data.message,t.api.show(e.data.message,5e3),e.data.message.includes("fillter expression")&&(t.show_filter=!0),t.renderWorker=null,n.terminate(),a()},n.onmessage=function(o){if(o.data.progress&&(t.rendering=!0,t.rendering_progress=Math.round(o.data.progress)),o.data._options){if(o.data._options.tableDict&&e.tableDict)for(var l in o.data._options.tableDict)e.tableDict[l]=o.data._options.tableDict[l];o.data._options.isFiltered&&(e.isFiltered=o.data._options.isFiltered)}o.data.finished?(console.log("finished rendering"),t.screenWidth>800?(t.rendering_status=e.filteredRows+", file:"+t.options.file_name+").",t.histogram_width<e.xy_range[1]-e.xy_range[0]||t.histogram_height<e.xy_range[3]-e.xy_range[2]?t.rendering_status="histogram rendered (truncated to "+t.histogram_width+"x"+t.histogram_height+", loc.:"+t.rendering_status:t.rendering_status="histogram rendered (loc.:"+t.rendering_status):t.rendering_status="rendered ",t.rendering_progress=100,r.putImageData(o.data.canvas_img_data,0,0),t.rendering=!1,t.rendered=!0,t.histogram_image=s.toDataURL("image/png"),t.render_canvas(o.data.canvas_img_data,100),i(t.histogram_image)):o.data.error&&(console.log("error during rendering "),t.rendered=!0,t.rendering=!1,t.rendering_status="error ocurred: "+o.data.message,t.api.show(o.data.message,5e3),o.data.message.includes("fillter expression")&&(t.show_filter=!0),t.renderWorker=null,n.terminate(),a())},t.rendering_status="rendering...",console.log("rendering in canvas");var l=[];for(var d in e.tableDict)l.push(e.tableDict[d].buffer);e.isFiltered&&l.push(e.isFiltered.buffer),n.postMessage({canvas_img_data:o,options:e},l)})},render3d:function(e){var t=this;return new r.a(function(i,a){try{Te(e,t.updateRenderStatus)}catch(e){a("3d rendering error"),console.error(e),t.rendering_status="something went wrong during rendering."}finally{t.rendering=!1,t.rendered=!0,i()}})},render_canvas:function(e,t){var i=this;this.rendered=!0;var a=void 0;t=t||1,this.leafletMap?a=this.leafletMap:(a=L.map("leaflet_histogram",{scrollWheelZoom:!1,smoothWheelZoom:!0,smoothSensitivity:1,minZoom:-10,maxZoom:6,center:[0,0],zoom:1,crs:L.CRS.Simple}),this.leafletMap=a);var n=function(e){i._canvas_data=e;var n=i.histogram_width,s=i.histogram_height,r=function(e){p.filterImage(e,p.brightness,0,t),i.use_lut&&p.filterImage(e,p.lut,g);var a=document.createElement("canvas");return a.width=i.histogram_width,a.height=i.histogram_height,a.getContext("2d").putImageData(e,0,0),a.toDataURL("image/png")}(e);i.export_histogram_png=r.replace("image/png","application/octet-stream"),i.screenWidth<=800?a.options.minZoom=-2:a.options.minZoom=-1;var o=a.unproject([0,s],a.options.zoom),l=a.unproject([n,0],a.options.zoom),d=new L.LatLngBounds(o,l);i._canvas_layer&&a.removeLayer(i._canvas_layer),i._canvas_layer=L.imageOverlay(r,d),i._canvas_layer.addTo(a),a.setMaxBounds(d),setTimeout(function(){i.leafletMap.invalidateSize(),i.$forceUpdate()},800)};if(e)n(e);else{var s=new Image;s.onload=function(){var t=document.createElement("canvas");t.width=s.width,t.height=s.height;var a=t.getContext("2d");a.drawImage(s,0,0),e=a.getImageData(0,0,t.width,t.height),n(e),i.$refs["brightness-slider"]&&i.$refs["brightness-slider"].refresh()},s.onerror=function(){i.rendering=!1,i.rendered=!0},s.src=this.histogram_image}},render_canvas2:function(e,t){var i=this;this.rendering_status="almost done, showing on the canvas...",t=t||0,console.log("adjust brightness",t);var a=this.histogram_image,n=document.getElementById("histogram_canvas"),s=n.getContext("2d"),r=new Image;this.use_lut;r.onload=function(){s.drawImage(r,0,0);var a=n.height,o=n.width;if(e=e||s.getImageData(0,0,o,a),!t){var l=p.min_max(e);t=0==l.max?1:255/l.max,i.current_render2d_config.brightness=parseInt(t)}p.filterImage(e,p.brightness,0,t),i.use_lut&&p.filterImage(e,p.lut,g),s.putImageData(e,0,0);var d=document.getElementById("histogram_canvas").toDataURL("image/png").replace("image/png","application/octet-stream");i.export_histogram_png=d,console.log("prepared url for image download"),i.rendering_progress=100,i.rendering_status="ready.",i.rendering=!1,i.rendered=!0,i.$refs["brightness-slider"]&&i.$refs["brightness-slider"].refresh()},r.onerror=function(){i.rendering=!1,i.rendered=!0},r.src=a},download_image:function(e,t){for(var i=atob(e.split(",")[1]),a=new ArrayBuffer(i.length),n=new Uint8Array(a),s=0;s<i.length;s++)n[s]=255&i.charCodeAt(s);try{var r=new Blob([a],{type:"application/octet-stream"})}catch(e){var o=new(window.WebKitBlobBuilder||window.MozBlobBuilder);o.append(a);r=o.getBlob("application/octet-stream")}var l=document.createElement("a");document.body.appendChild(l),l.style="display: none";var d=(window.webkitURL||window.URL).createObjectURL(r);l.href=d,l.download=t,l.click(),window.URL.revokeObjectURL(d)}}},Re={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"viewer"},[i("div",{staticClass:"md-title"},[e._v(e._s(e.title))]),e._v(" "),i("md-app",{directives:[{name:"show",rawName:"v-show",value:e.options,expression:"options"}]},[!e.menuVisible||e.options&&e.options.tableDict&&e.show_filter||null!==e.selected_filter&&null!==e.selected_filter_max&&null!==e.selected_filter_min?i("md-app-toolbar",{staticClass:"md-transparent md-dense",staticStyle:{"z-index":"99"},attrs:{"md-elevation":"0"}},[i("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[!e.menuVisible&&e.options?i("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.menuVisible=!0}}},[i("md-icon",[e._v("menu")])],1):e._e(),e._v(" "),e.options?i("div",{staticClass:"md-layout md-xsmall-hide"},[i("md-switch",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&e.options&&e.options.tableDict&&e.options.tableDict.z,expression:"rendered && options && options.tableDict && options.tableDict.z"}],attrs:{disabled:!e.options||!e.options.tableDict||!e.options.tableDict.z&&!e.use_3d,name:"use LUT"},on:{change:function(t){e.switch3DView(e.use_3d)}},model:{value:e.use_3d,callback:function(t){e.use_3d=t},expression:"use_3d"}},[e._v("3D View")]),e._v("  \n               ")],1):e._e(),e._v(" "),e.filter_enabled&&e.rendered&&null!==e.selected_filter&&null!==e.selected_filter_max&&null!==e.selected_filter_min?i("div",{staticClass:"md-toolbar-section-start slider-toolbar"},[i("div",{staticClass:"md-layout-item",attrs:{flex:""}},[i("span",{staticClass:"md-xsmall-hide"},[e._v("Set range for")]),e._v(" "),i("md-chip",[e._v(e._s(e.selected_filter))]),e._v(" "+e._s((e.filter_ranges[e.selected_filter][1]-e.filter_ranges[e.selected_filter][0]).toFixed(1))+", "+e._s(e.filter_ranges[e.selected_filter])+"\n                   "),i("div",[i("vue-slider",{ref:"filter-slider",attrs:{disabled:e.rendering,"tooltip-dir":"bottom",max:e.selected_filter_max,min:e.selected_filter_min},on:{"drag-end":function(t){e.update_selected_filter()}},model:{value:e.filter_ranges[e.selected_filter],callback:function(t){e.$set(e.filter_ranges,e.selected_filter,t)},expression:"filter_ranges[selected_filter]"}}),e._v(" "),i("md-tooltip",[e._v(' Adjust filter range for "'+e._s(this.selected_filter)+'"')])],1)],1)]):e._e(),e._v(" "),e.options&&e.options.tableDict&&e.show_filter?i("div",{staticClass:"md-toolbar-section-start",attrs:{flex:""}},[i("md-button",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&e.show_filter,expression:"rendered && show_filter"}],staticClass:"md-accent md-icon-button",attrs:{disabled:e.rendering},on:{click:function(t){e.plotHist()}}},[i("md-icon",[e._v("refresh")]),e._v(" "),i("md-tooltip",[e._v(" Refresh ")])],1),e._v(" "),i("md-field",[i("label",{staticClass:"md-xsmall-hide",attrs:{for:"filter-id"}},[e._v("Filter Expression (e.g. frame>1000 and random()<0.1)")]),e._v(" "),i("md-input",{attrs:{disabled:e.rendering,type:"text"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.plotHist()}},model:{value:e.filter_expression,callback:function(t){e.filter_expression=t},expression:"filter_expression"}}),e._v(" "),i("span",{staticClass:"md-helper-text md-xsmall-hide"},[e._v(e._s(e.filter_tooltip))]),e._v(" "),i("md-tooltip",[e._v(e._s(e.filter_tooltip))])],1)],1):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.running&&!e.menuVisible&&e.options&&e.screenWidth>800,expression:"running && !menuVisible && options && screenWidth>800"}],staticClass:"md-toolbar-section-end md-xsmall-hide",attrs:{layout:"row"}},[i("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}})],1)],1)]):e._e(),e._v(" "),i("md-app-drawer",{attrs:{"md-active":e.menuVisible,"md-persistent":"full"},on:{"update:mdActive":function(t){e.menuVisible=t}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.running,expression:"!running"}],staticClass:"md-toolbar-row",attrs:{flex:""}},[e._t("actions",[i("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.selectFile(!0)}}},[i("md-icon",[e._v("add")]),e._v(" "),i("md-tooltip",[e._v("Load another file")])],1),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:e.shareFile}},[i("md-icon",[e._v("share")]),e._v("Share\n                     "),i("md-tooltip",[e._v("share this smlm file")])],1),e._v(" "),i("div",{staticClass:"md-toolbar-section-end"},[i("md-button",{staticClass:"md-icon-button md-dense md-raised",on:{click:function(t){e.menuVisible=!e.menuVisible}}},[i("md-icon",[e._v("keyboard_arrow_left")])],1)],1)],{download:e.downloadSmlmFile})],2),e._v(" "),e.running?i("div",{attrs:{layout:"row"}},[i("md-divider"),e._v(" "),i("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),i("br")],1):e._e(),e._v(" "),e.smlm?i("div",[i("span",{staticClass:"md-list-item-text"},[e._v("Files")]),e._v(" "),i("md-divider"),e._v(" "),e.loaded_sample&&e.smlm?i("md-list",e._l(e.loaded_sample.files,function(t,a){return i("md-list-item",{key:a,attrs:{"md-expand":e.smlm&&e.smlm.manifest.hash==a,"md-expanded":t.expandFiles},on:{click:function(i){e.showFilesDialog=!1,e.loadS3File(t,a)},"update:mdExpanded":function(i){e.$set(t,"expandFiles",i)}}},[e._v("\n                     "+e._s(e.smlm.manifest.hash==a?"+":"")+" "),e._l(t.tags,function(t){return i("md-chip",{key:t},[e._v(e._s(t))])}),e._v(" "),i("span",{class:e.selected_s3_file==a?"files-item-1-selected":"files-item-1"},[e._v(e._s(t.name))]),e._v(" "),e.smlm&&e.smlm.manifest.hash==a?i("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},e._l(e.smlm.files,function(t,a){return i("md-list-item",{key:t.hash,on:{click:function(i){e.showFilesDialog=!1,e.loadSmlmFile(t)}}},[i("span",{class:e.selected_smlm_file_hash==t.hash?"files-item-2-selected":"files-item-2"},[e._v("  - \n                             "),e._l(t.tags,function(t,a){return a<3?i("md-chip",{key:t},[e._v(e._s(t))]):e._e()}),e._v(e._s(t.name)+"\n                           ")],2)])})):e._e()],2)})):e._e(),e._v(" "),!e.loaded_sample&&e.smlm&&e.smlm.files?i("md-list",e._l(e.smlm.files,function(t,a){return i("md-list-item",{key:t.hash,on:{click:function(i){e.showFilesDialog=!1,e.loadSmlmFile(t)}}},[i("span",{class:e.selected_smlm_file_hash==t.hash?"files-item-2-selected":"files-item-2"},[e._v(" - \n                     "),e._l(t.tags,function(t,a){return a<3?i("md-chip",{key:t},[e._v(e._s(t))]):e._e()}),e._v(e._s(t.name)+"\n                   ")],2)])})):e._e()],1):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"md-layout",attrs:{"md-vertical-align":"end"}},[i("input",{ref:"select_file_input",staticClass:"md-file",attrs:{type:"file"},on:{change:e.fileSelected}})]),e._v(" "),e.filter_enabled?i("div",[i("span",{staticClass:"md-list-item-text"},[e._v("Apply filter")]),e._v(" "),i("md-divider"),e._v(" "),i("p",[e._v("click a name to set the value range:")]),e._v(" "),e.options&&e.options.headers?i("div",e._l(e.options.headers,function(t,a){return i("md-chip",{directives:[{name:"show",rawName:"v-show",value:e.options&&e.options.headers,expression:"options&&options.headers"}],key:a,class:e.selected_filter==t?"md-primary":"",attrs:{"md-clickable":""},on:{click:function(i){e.show_filter=!1,e.switch_selected_filter(t)}}},[e._v(e._s(t)+"\n                   "),i("md-tooltip",[e._v("click to set the range of '"+e._s(t)+"'")])],1)})):e._e(),e._v(" "),i("md-button",{attrs:{disabled:e.rendering},on:{click:function(t){e.reset_filters()}}},[i("md-icon",[e._v("settings_backup_restore")]),e._v("reset filter\n                 "),i("md-tooltip",[e._v(" Reset filter ")])],1),e._v(" "),i("md-button",{directives:[{name:"show",rawName:"v-show",value:e.rendered,expression:"rendered"}],on:{click:function(t){e.show_filter=!e.show_filter,e.selected_filter=null}}},[i("md-icon",[e._v("details")]),e._v("filter expression\n                 "),i("md-tooltip",[e._v(" Show filter expression")])],1),e._v(" "),i("br"),e._v(" "),i("br")],1):e._e(),e._v(" "),i("span",{staticClass:"md-list-item-text"},[e._v("Adjust brightness")]),e._v(" "),i("md-divider"),e._v(" "),i("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[i("div",{staticClass:"md-layout-item"},[i("div",[i("vue-slider",{ref:"brightness-slider",attrs:{disabled:e.rendering,"tooltip-dir":"bottom",max:255,min:1},on:{"drag-end":function(t){e.updateCanvas()}},model:{value:e.current_render2d_config.brightness,callback:function(t){e.$set(e.current_render2d_config,"brightness",t)},expression:"current_render2d_config.brightness"}}),e._v(" "),i("md-tooltip",[e._v(" Adjust brightness ")])],1),e._v(" "),i("br")])]),e._v(" "),i("span",{staticClass:"md-list-item-text"},[e._v("More options")]),e._v(" "),i("md-divider"),e._v(" "),i("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},[i("md-list-item",{staticClass:"md-primary menu-button"},[i("md-switch",{attrs:{name:"use LUT"},on:{change:function(t){e.updateCanvas()}},model:{value:e.use_lut,callback:function(t){e.use_lut=t},expression:"use_lut"}},[i("span",{staticClass:"md-list-item-text"},[e._v("Apply LUT")])])],1),e._v(" "),i("md-list-item",[i("md-field",[i("label",{attrs:{for:"pixel_size"}},[e._v("Pixel Size (nm)")]),e._v(" "),i("md-input",{attrs:{type:"text",name:"pixel_size"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.plotHist()}},model:{value:e.pixel_size,callback:function(t){e.pixel_size=t},expression:"pixel_size"}})],1),e._v(" "),i("md-field",[i("label",{attrs:{for:"offset_mode"}},[e._v("Offset Mode")]),e._v(" "),i("md-select",{attrs:{name:"offset-mode"},on:{"md-closed":function(t){e.options&&e.options.tableDict&&e.plotHist()}},model:{value:e.offset_mode,callback:function(t){e.offset_mode=t},expression:"offset_mode"}},[i("md-option",{attrs:{value:"min-max"}},[e._v("min-max")]),e._v(" "),i("md-option",{attrs:{value:"zero-max"}},[e._v("zero-max")])],1)],1)],1),e._v(" "),e.tags?i("md-list-item",[i("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var i=t.chip;return[e._v("\n                        "+e._s(i)+"\n                        ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[i("div",{staticClass:"md-helper-text"},[e._v("please use tags to label this sample. E.g.: microtubule, hela, AF647")])])],1):e._e(),e._v(" "),i("md-list-item",{staticClass:"md-primary menu-button",on:{click:function(t){e.showInfoDialog=!0}}},[i("md-icon",[e._v("info")]),i("span",{staticClass:"md-list-item-text"},[e._v("Info")]),e._v(" "),i("md-tooltip",[e._v("show info")])],1),e._v(" "),i("md-list-item",{staticClass:"md-primary menu-button",on:{click:e.downloadSmlmFile}},[i("md-icon",[e._v("file_download")]),i("span",{staticClass:"md-list-item-text"},[e._v("Export")]),e._v(" "),e.smlm&&e.smlm.isSMLM?i("md-tooltip",[e._v("save as .smlm file")]):i("md-tooltip",[e._v("save as a compressed zip file")])],1),e._v(" "),i("md-list-item",{directives:[{name:"show",rawName:"v-show",value:e.export_histogram_png,expression:"export_histogram_png"}],staticClass:"md-primary menu-button",on:{click:function(t){e.download_image(e.export_histogram_png,"exported_input.png")}}},[i("md-icon",[e._v("save")]),i("span",{staticClass:"md-list-item-text"},[e._v("Save image")]),e._v(" "),i("md-tooltip",[e._v("download and save current image")])],1)],1)],1),e._v(" "),i("md-app-content",[(e.rendered||e.rendering)&&e.options&&e.options.tableDict?i("md-progress-bar",{attrs:{"md-value":e.rendering_progress}}):e._e(),e._v(" "),e.options?i("div",{staticClass:"canvas-container"},[(e.rendered||e.rendering)&&e.options&&e.options.tableDict?i("div",{staticClass:"md-layout render-info"},[i("span",[e._v(e._s(e.rendering_status)+" "+e._s(e.rendering_progress>0?e.rendering_progress+"%":"")+" ")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],staticClass:"render-info"},[e._v("   fps:"+e._s(e.fps)+", ppf:"+e._s(e.ppf)+" ")])]):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&!e.use_3d,expression:"rendered && !use_3d"}],attrs:{id:"leaflet_histogram"}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],attrs:{id:"gui-webgl"}}),e._v(" "),i("canvas",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],attrs:{id:"histogram_canvas_3d"}})]):e._e(),e._v(" "),e.options||e.shared_url_mode?e._e():i("md-empty-state",{attrs:{flex:"","md-icon":"hourglass_empty","md-label":"Open a localization table","md-description":"Render your table in the browser, process and share it with our server."}},[e.running?i("div",[i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),i("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait...":"")+" ")])],1):e._e(),e._v(" "),i("md-button",{staticClass:"md-primary md-raised",attrs:{disabled:e.running},on:{click:function(t){e.selectFile(!1)}}},[i("md-icon",[e._v("add")]),e._v("Open a file\n                ")],1),e._v(" "),i("md-button",{staticClass:"md-primary",attrs:{id:"repository-button",disabled:e.running,to:"/repository"}},[e._v("\n                  No data? checkout the repository for public data.\n                ")]),e._v(" "),i("br"),e._v(" "),i("md-card",{staticClass:"faq-card"},[i("md-card-content",[i("h2",[e._v("FAQ")]),e._v(" "),i("h3",[e._v("What are the supported file formats?")]),e._v(" "),i("p",[e._v("Currently, you can load files with the following formats: "),i("a",{attrs:{href:"https://github.com/imodpasteur/smlm-file-format",target:"_blank"}},[e._v("SMLM(.smlm)")]),e._v(", ThunderSTORM(.csv/.xls), RapidSTROM, ZEISS(ELYRA), Nikon NSTORM(txt), .png, .jpg.")]),e._v(" "),i("p",[e._v(" If you have other file format which is not supported yet, please "),i("a",{attrs:{href:"https://www.dropbox.com/request/IyZ7HkzHUpB0t5Mkp46l",target:"_blank"}},[e._v("upload a sample file")]),e._v(", and "),i("a",{attrs:{href:"https://oeway.typeform.com/to/rdkPmd",target:"_blank"}},[e._v("send us a message")]),e._v(" to describe your file format, we will try to support your file format. ")]),e._v(" "),i("h3",[e._v("where does my data go?")]),e._v(" "),i("p",[e._v("Don't worry, your data will stay in your browser, and will not go to our server unless you use the sharing feature of ShareLoc.xyz.\n                    If you share data privately with our server, by default, no one else could access it, and we won't use it for other purposes without your permission.")]),e._v(" "),i("md-button",{staticClass:"md-primary",attrs:{to:"/faq"}},[e._v("read more")])],1)],1)],1),e._v(" "),!e.options&&e.shared_url_mode?i("md-empty-state",{attrs:{flex:"","md-icon":"hourglass_empty","md-label":"Loading sample...","md-description":"Please wait, this may take a while..."}},[e.running?i("div",[i("md-progress-bar",{attrs:{"md-value":e.running_progress}}),e._v(" "),i("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait...":"")+" ")])],1):e._e(),e._v(" "),e.loading_shared_url?i("div",[i("md-progress-spinner",{attrs:{"md-diameter":100,"md-stroke":10,"md-mode":"indeterminate"}})],1):e._e()]):e._e()],1)],1),e._v(" "),i("md-dialog-alert",{attrs:{"md-active":e.showErrorDialog,"md-content":e.error_content,"md-confirm-text":"OK","md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showErrorDialog=t}}}),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showUploading,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showUploading=t}}},[i("md-dialog-content",[i("div",{attrs:{layout:"row"}},[i("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),i("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),i("br")],1)]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showUploading=!1}}},[e._v("Close")])],1)],1),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showImportDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showImportDialog=t}}},[i("md-dialog-content",[i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[e.selected_file?i("md-field",[i("label",{attrs:{for:"file-format"}},[e._v("File Format")]),e._v(" "),i("md-select",{attrs:{name:"file-format",id:"file-format"},model:{value:e.text_file_format,callback:function(t){e.text_file_format=t},expression:"text_file_format"}},e._l(e.supported_file_formats,function(t,a){return e.selected_file_name.endsWith(t.extension)||-1==e.selected_file_name.indexOf(".")?i("md-option",{key:a,attrs:{value:a}},[e._v(e._s(a))]):e._e()}))],1):e._e(),e._v(" "),i("md-field",[i("label",{attrs:{for:"pixel_size"}},[e._v("Pixel Size (nm)")]),e._v(" "),i("md-input",{attrs:{type:"text",name:"pixel_size"},model:{value:e.pixel_size,callback:function(t){e.pixel_size=t},expression:"pixel_size"}})],1),e._v(" "),i("div",{staticClass:"md-flex"},[i("label",[e._v("Tags for this channel/file")]),e._v(" "),i("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a file tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var i=t.chip;return[e._v("\n                    "+e._s(i)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[i("div",{staticClass:"md-helper-text"},[e._v("e.g. SR for SuperRes image, WF for widefield")])])],1),e._v(" "),this.smlm?i("md-switch",{attrs:{name:"append"},model:{value:e.append_mode,callback:function(t){e.append_mode=t},expression:"append_mode"}},[e._v("Append to the current file")]):e._e(),e._v(" "),i("md-switch",{attrs:{name:"more_options"},model:{value:e.show_more_import_options,callback:function(t){e.show_more_import_options=t},expression:"show_more_import_options"}},[e._v("more options")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.show_more_import_options,expression:"show_more_import_options"}]},[i("label",[e._v("File content:")]),e._v(" "),e._l(e.file_sample_lines,function(t,a){return i("p",{key:a},[e._v(" "+e._s(t)+" ")])}),e._v(" "),i("p",[e._v("...")]),e._v(" "),i("md-field",[i("label",{attrs:{for:"offset_mode"}},[e._v(" Offset Mode")]),e._v(" "),i("md-select",{attrs:{name:"offset-mode"},model:{value:e.offset_mode,callback:function(t){e.offset_mode=t},expression:"offset_mode"}},[i("md-option",{attrs:{value:"min-max"}},[e._v("min-max")]),e._v(" "),i("md-option",{attrs:{value:"zero-max"}},[e._v("zero-max")])],1)],1),e._v(" "),i("md-field",[i("label",{attrs:{for:"offset_x"}},[e._v("Offset(x)")]),e._v(" "),i("md-input",{attrs:{type:"text",name:"offset_x"},model:{value:e.offset_x,callback:function(t){e.offset_x=t},expression:"offset_x"}})],1),e._v(" "),i("md-field",[i("label",{attrs:{for:"offset_y"}},[e._v("Offset(y)")]),e._v(" "),i("md-input",{attrs:{type:"text",name:"offset_y"},model:{value:e.offset_y,callback:function(t){e.offset_y=t},expression:"offset_y"}})],1)],2)],1)])]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary",on:{click:function(t){e.loadFile(),e.showImportDialog=!1}}},[e._v("OK")]),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showImportDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showInfoDialog},on:{"update:mdActive":function(t){e.showInfoDialog=t}}},[i("md-dialog-content",[i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[i("label",[e._v("Tags")]),e._v(" "),i("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var i=t.chip;return[e._v("\n                    "+e._s(i)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[i("div",{staticClass:"md-helper-text"},[e._v("Please use tags to describe your sample")])])],1)])]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("OK")]),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showProcessDialog},on:{"update:mdActive":function(t){e.showProcessDialog=t}}},[i("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[i("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[i("div",{staticClass:"md-toolbar-section-start"},[i("h2",[e._v("Processing with A-net")])])])]),e._v(" "),i("md-dialog-content",[i("label",[e._v("Step 1: Select an shareLoc.xyz model:")]),e._v(" "),i("md-field",[i("md-select",{attrs:{name:"worker"},on:{"md-selected":e.workerSelected},model:{value:e.selected_worker_uri,callback:function(t){e.selected_worker_uri=t},expression:"selected_worker_uri"}},e._l(e.worker_list,function(t){return i("md-option",{key:t._id.$oid,attrs:{value:t.uri}},[e._v(e._s(t.uri))])}))],1),e._v(" "),e.selected_worker&&e.selected_worker.tags?i("div",[e.selected_worker.description?i("p",[e._v(e._s(e.selected_worker.description))]):e._e(),e._v(" "),i("label",[e._v("In order to use this model, your sample must contain the following tag(s):")]),e._v(" "),i("div",{staticClass:"md-layout-row md-gutter"},[e._l(e.selected_worker.tags,function(t){return i("md-chip",{key:t,attrs:{disabled:e.anet_running,"md-static":"","md-clickable":""},on:{click:function(i){e.tags.indexOf(t)<0&&e.tags.push(t)}}},[e._v("\n                 "+e._s(t)+"\n               ")])}),e._v(" "),i("div",{staticClass:"md-helper-text"},[e._v("You can click the above tag(s) to tag the sample.")])],2)]):e._e(),e._v(" "),i("br"),e._v(" "),i("div",{staticClass:"md-flex"},[i("label",[e._v("Step 2: tag your sample")]),e._v(" "),i("md-chips",{attrs:{disabled:e.anet_running,"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var i=t.chip;return[e._v("\n                    "+e._s(i)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[i("div",{staticClass:"md-helper-text"},[e._v("Please make sure these tags describe your sample accurately.")])])],1),e._v(" "),i("br"),e._v(" "),i("p",[e._v("Warning: If the tags you provided do not match the actual content of your image, ** please do not trust the result **.")]),e._v(" "),this.widefield_available&&this.selected_worker_uri&&-1!==this.selected_worker_uri.indexOf("_wf")?i("md-switch",{attrs:{name:"include_widefield"},model:{value:e.use_widefield,callback:function(t){e.use_widefield=t},expression:"use_widefield"}},[e._v("Include widefield")]):e._e(),e._v(" "),i("br"),e._v(" "),i("p",[e._v('Currently, we only provide limited types of model trained with microtubules and mitochondria. In order to support more, please consider contributing your data through "project one-for-all".')]),e._v(" "),i("md-button",{staticClass:"md-primary",attrs:{disabled:e.loading_worker_list||e.anet_running},on:{click:function(t){e.sendForTraining()}}},[i("md-icon",[e._v("send")]),e._v("Send for Training")],1),e._v(" "),i("md-button",{directives:[{name:"show",rawName:"v-show",value:!e.show140,expression:"!show140"}],staticClass:"md-primary",on:{click:function(t){e.show140=!0}}},[e._v("About project one-for-all")]),e._v(" "),i("br"),e._v(" "),e.worker_validation_msg?i("p",[e._v(e._s(e.worker_validation_msg))]):e._e(),e._v(" "),e.anet_running?i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[i("md-progress-spinner",{attrs:{"md-diameter":100,"md-stroke":10,"md-mode":"indeterminate"}})],1)]):e._e()],1),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary md-raised",attrs:{disabled:e.loading_worker_list||e.anet_running},on:{click:function(t){e.runAnetProcess()}}},[i("md-icon",[e._v("play_arrow")]),e._v("Process")],1),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showProcessDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),i("md-dialog",{attrs:{"md-active":e.show140},on:{"update:mdActive":function(t){e.show140=t}}},[i("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[i("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[i("div",{staticClass:"md-toolbar-section-start"},[i("h2",[e._v("Please support project one-for-all -- one model for all")])])])]),e._v(" "),i("md-dialog-content",[i("p",[e._v("As you may know that better results can be achieved if neural networks was trained on data with the same or similar type of data. Typically we need to train a dedicated model for each type of data or structure.")]),e._v(" "),i("p",[e._v("However, this type of model will not scale, because we will end up with a huge collection of pretrained model files, consuming lots of resources and time to train but can not be used except for data looks similar. Plus, it will pose lots of challenges to the infrastructure to store, manage these models.")]),e._v(" "),i("p",[e._v("To address this issue, we are initiating a project aiming for train a single neural network model for all types of biological structure, all types of labeling technique. ")]),e._v(" "),i("p",[e._v("The main idea is to train a single neural network incrementally with more and more data.")]),e._v(" "),i("p",[e._v("It a hard task because when a single network sees different type of data, it will get confused between different types thus compromise the quality.")]),e._v(" "),i("p",[e._v("The switch mechanism shown in our paper provides a way to allow the network to adjust itself to different type of data. While we have shown it works to train a single network for 2~3 types of data, we would like to scale the experiment to tens or even hundreds types.")]),e._v(" "),i("p",[e._v("We will train the network 24x7, and it will be continuously improved as the amount of data grows. Snapshots of the trained model will be freely available for everyone.")]),e._v(" "),i("p",[e._v('We name it "project one-for-all" or "project 140".')]),e._v(" "),i("p",[e._v("The following components will be available for everyone as the project goes:")]),e._v(" "),i("p",[e._v("- an open database for hosting localization microscopy data, accessible through "),i("a",{attrs:{href:"#/repository",target:"_blank"}},[e._v("the repository")]),e._v(".")]),e._v(" "),i("p",[e._v("- a portable smlm file format for saving large localization data, multi-channel, multi-FOV scanning, or even raw images.")]),e._v(" "),i("p",[e._v("- pre-trained models for all types of structure, microscopy etc. ")]),e._v(" "),i("br"),e._v(" "),i("p",[e._v('To support our mission, please donate your data to the project by clicking "Send for Training".')])]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary md-raised",on:{click:function(t){e.show140=!1}}},[e._v("OK")])],1)],1),e._v(" "),e.smlm?i("md-dialog",{attrs:{"md-active":e.showShareDialog},on:{"update:mdActive":function(t){e.showShareDialog=t}}},[i("md-dialog-content",[i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[i("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[i("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[i("div",{staticClass:"md-toolbar-section-start"},[i("h2",[e._v("Share your sample")])])])]),e._v(" "),e.smlm?i("form",[i("md-field",[i("label",[e._v("Name")]),e._v(" "),i("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.name,callback:function(t){e.$set(e.smlm.manifest,"name",t)},expression:"smlm.manifest.name"}})],1),e._v(" "),i("md-field",[i("label",[e._v("Description")]),e._v(" "),i("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.description,callback:function(t){e.$set(e.smlm.manifest,"description",t)},expression:"smlm.manifest.description"}})],1),e._v(" "),i("label",[e._v("Tags")]),e._v(" "),i("md-chips",{attrs:{"md-limit":20,"md-placeholder":"type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var i=t.chip;return[e._v("\n                    "+e._s(i)+"\n                    ")]}}]),model:{value:e.smlm.manifest.tags,callback:function(t){e.$set(e.smlm.manifest,"tags",t)},expression:"smlm.manifest.tags"}},[i("div",{staticClass:"md-helper-text"},[e._v("Please use tags to describe the structure, labeled protein, the dye etc.")])]),e._v(" "),i("md-switch",{attrs:{name:"get_shared_link"},model:{value:e.get_shared_link,callback:function(t){e.get_shared_link=t},expression:"get_shared_link"}},[e._v("Get a private shared link")]),e._v(" "),i("md-switch",{attrs:{name:"make_public"},model:{value:e.make_public,callback:function(t){e.make_public=t},expression:"make_public"}},[e._v("Publish to the Repository")]),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.make_public,expression:"make_public"}]},[e._v("A permanent public url will be generated for your data, and posted on the website. You won't be able to remove the url or the data, but you can tag it as 'deprecated'.")]),e._v(" "),e.make_public?i("md-autocomplete",{attrs:{"md-options":e.licenses,"md-dense":""},model:{value:e.smlm.manifest.license,callback:function(t){e.$set(e.smlm.manifest,"license",t)},expression:"smlm.manifest.license"}},[i("label",[e._v("License")])]):e._e(),e._v(" "),e.make_public?i("p",[e._v("To promote an open community, if no license specified, you data will be automatically licensed under a "),i("a",{attrs:{href:"https://creativecommons.org/licenses/by/4.0/",target:"_blank"}},[e._v("Creative Commons Attribution 4.0 International license.")])]):e._e(),e._v(" "),e.make_public?i("md-field",[i("label",[e._v("How to cite?")]),e._v(" "),i("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.citeAs,callback:function(t){e.$set(e.smlm.manifest,"citeAs",t)},expression:"smlm.manifest.citeAs"}})],1):e._e()],1):e._e(),e._v(" "),i("div",{staticClass:"md-layout md-alignment-center-center"},[i("img",{staticClass:"thumbnail-img",attrs:{src:e.smlm.manifest.thumbnail,alt:e.smlm.manifest.name}})])],1)])]),e._v(" "),i("md-dialog-actions",["admin"==e.store.authrole?i("md-button",{staticClass:"md-primary",on:{click:function(t){e.shareSample(!0,!0),e.showShareDialog=!1}}},[e._v("Force Upload")]):e._e(),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.shareSample(!0),e.showShareDialog=!1}}},[e._v("OK")]),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showShareDialog=!1}}},[e._v("Cancel")])],1)],1):e._e(),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showFilesDialog},on:{"update:mdActive":function(t){e.showFilesDialog=t}}},[i("md-dialog-content",[i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[i("md-button",{staticClass:"md-primary ",on:{click:function(t){e.showFilesDialog=!1,e.selectFile(!1)}}},[i("md-icon",[e._v("add")]),e._v(" Load a new file\n              "),i("md-tooltip",[e._v("Open a File")])],1),e._v(" "),i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showFilesDialog=!1,e.selectFile(!0)}}},[i("md-icon",[e._v("add")]),e._v("Append a file\n                "),i("md-tooltip",[e._v("Add an image to the current smlm file")])],1)],1)])]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showFilesDialog=!1}}},[e._v("OK")])],1)],1),e._v(" "),i("md-dialog",{attrs:{"md-active":e.showSharedLink},on:{"update:mdActive":function(t){e.showSharedLink=t}}},[i("md-dialog-content",[i("div",{staticClass:"md-layout-row md-gutter"},[i("div",{staticClass:"md-flex"},[i("h1",[e._v("Please copy the following URL for sharing")]),e._v(" "),i("a",{attrs:{href:e.shared_link,target:"_blank"}},[e._v(e._s(e.shared_link))])])])]),e._v(" "),i("md-dialog-actions",[i("md-button",{staticClass:"md-primary",on:{click:function(t){e.showSharedLink=!1}}},[e._v("OK")])],1)],1),e._v(" "),i("md-snackbar",{staticClass:"md-accent",attrs:{"md-position":"center","md-active":e.showSnackbar,"md-duration":e.snackbar_duration},on:{"update:mdActive":function(t){e.showSnackbar=t}}},[i("span",[e._v(e._s(e.snackbar_info))]),e._v(" "),i("md-button",{staticClass:"md-accent",on:{click:function(t){e.showSnackbar=!1}}},[e._v("close")])],1)],1)},staticRenderFns:[]};var Ie=i("VU/8")(De,Re,!1,function(e){i("dZnx")},"data-v-2a179b7d",null).exports;a.default.use(n.a);var Le=new n.a({base:window.location.pathName,routes:[{path:"/",name:"Home",component:Ie}]}),We=i("Lgyv"),Ue=i.n(We);i("4+hh"),i("giDI");var Ne=i("EFqf"),Oe=i.n(Ne),Pe={name:"faq",data:function(){return{source:"\n\nTo be done...\n\n",router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},computed:{compiledMarkdown:function(){return Oe()(this.source,{sanitize:!0})}},mounted:function(){},methods:{}},je={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"faq"},[t("md-subheader",[this._v("FREQUENTLY ASKED QUESTIONS")]),this._v(" "),t("md-card",[t("md-card-header"),this._v(" "),t("md-card-content",[t("div",{domProps:{innerHTML:this._s(this.compiledMarkdown)}})])],1)],1)},staticRenderFns:[]};var Be=i("VU/8")(Pe,je,!1,function(e){i("A+BG")},"data-v-62bff1b8",null).exports,$e={debug:!0,wsuri:"wss://dai.pasteur.fr/ws",signed_in:!1,event_bus:new a.default,authid:"",authrole:"",uid:"",api:{},session:null,connection:null},Ve={name:"app",data:function(){return{store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;this.$nextTick(function(){var t=function(t){e.store.windowHeight=window.innerHeight,e.store.windowWidth=window.innerWidth,e.store.event_bus.$emit("resize",{height:e.store.windowHeight,width:e.store.windowWidth})};t(),document.addEventListener("orientationchange",window.onresize=t),e.store.event_bus.$on("connected",function(e){try{ga("set","userId",e)}catch(e){console.error("google analytics error:",e)}}),e.api.ga_send=function(e){try{ga("send","pageview",e),console.log("ga_send:",e)}catch(e){console.error("google analytics error:",e)}}})},methods:{},watch:{$route:function(e){try{ga("send","pageview",e.path),console.log("pageview:",e.path)}catch(e){console.error("google analytics error:",e)}}}},Ze={render:function(){var e=this.$createElement;return(this._self._c||e)("router-view")},staticRenderFns:[]};var He=i("VU/8")(Ve,Ze,!1,function(e){i("lZqh")},null,null).exports,Ye=i("GDE4"),Xe=i.n(Ye);a.default.config.productionTip=!1,a.default.use(Ue.a),a.default.component("vue-slider",Xe.a),a.default.component("viewer",Ie),a.default.component("faq",Be);a.default.filter("truncate",function(e,t,i){i=i||"...";var a=document.createElement("div");a.innerHTML=e;var n=a.textContent;return n.length>t?n.slice(0,t)+i:n}),new a.default({el:"#app",router:Le,data:{store:$e,router:Le},template:"<App/>",components:{App:He}})},dZnx:function(e,t){},giDI:function(e,t){},lZqh:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.d65ded3bcc0bd1c368ac.js.map